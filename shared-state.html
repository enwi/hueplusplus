<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hueplusplus: Shared state cache</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">hueplusplus<span id="projectnumber">&#160;1.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Shared state cache</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md23">What shared state means</a><ul><li class="level2"><a href="#autotoc_md24">Advantages of shared state</a></li>
<li class="level2"><a href="#autotoc_md25">Disadvantages of shared state</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md26">Enabling shared state</a></li>
<li class="level1"><a href="#autotoc_md27">Shared state and refreshing</a><ul><li class="level2"><a href="#autotoc_md28">Example:</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md23"></a>
What shared state means</h1>
<p>There are two ways in which the API state (internally JSON) can be handled:</p><ol type="1">
<li>Every resource instance holds its own cache of the state (default).</li>
<li>All instances share the cache of the entire bridge.</li>
</ol>
<h2><a class="anchor" id="autotoc_md24"></a>
Advantages of shared state</h2>
<ul>
<li>Different resources are always consistent on the library level. If one part of the code uses the light with id 1 and turns it off, light 1 is also off when using a different variable to access it.</li>
<li>The number of requests can be reduced, because they can be bundled together on a higher cache level.</li>
</ul>
<h2><a class="anchor" id="autotoc_md25"></a>
Disadvantages of shared state</h2>
<ul>
<li>Different objects are no longer thread safe, you cannot use <b>any</b> parts of the library from multiple threads (without locking).</li>
<li>Changes are not transparent. For example, a <code>const Light</code> can suddenly change its name, because the name was changed somewhere else in the code.</li>
</ul>
<p>Because of these considerations, shared state is disabled by default.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Enabling shared state</h1>
<p>Shared state can be configured when the bridge is first constructed, either in <a class="el" href="classhueplusplus_1_1_bridge_finder.html#a9ff121c380ceaceaf5da2b7a772e5c4b">getBridge()</a> or in the <a class="el" href="classhueplusplus_1_1_bridge.html#a5fa0378ab3552a82d611fba6701bcad6">constructor</a>. Set <code>sharedState</code> to <code>true</code> to keep all resources connected to the bridge cache. </p><div class="fragment"><div class="line">    <a class="code hl_class" href="classhueplusplus_1_1_bridge.html">hueplusplus::Bridge</a> bridge = finder.getBridge(bridges[0], <span class="keyword">true</span>);</div>
<div class="ttc" id="aclasshueplusplus_1_1_bridge_html"><div class="ttname"><a href="classhueplusplus_1_1_bridge.html">hueplusplus::Bridge</a></div><div class="ttdoc">Bridge class for a bridge.</div><div class="ttdef"><b>Definition</b> Bridge.h:139</div></div>
</div><!-- fragment --> <div class="fragment"><div class="line">    <a class="code hl_class" href="classhueplusplus_1_1_bridge.html">hueplusplus::Bridge</a> bridge(<span class="stringliteral">&quot;192.168.2.102&quot;</span>, 80, <span class="stringliteral">&quot;&lt;username&gt;&quot;</span>, handler, <span class="stringliteral">&quot;&quot;</span>, std::chrono::seconds(10), <span class="keyword">true</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27"></a>
Shared state and refreshing</h1>
<p>When shared cache is used, refreshes use a hierarchichal structure to determine how much should be requested from the bridge. Every level has its own last update time and refresh duration. First, it is checked whether the higher level is up to date and refresh everything if not. Otherwise, only the lowest necessary level is requested from the bridge to be more efficient.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Example:</h2>
<div class="fragment"><div class="line">    bridge.<a class="code hl_function" href="classhueplusplus_1_1_bridge.html#adc8372a1ca66b86098ae5a841106d89b">setRefreshDuration</a>(std::chrono::minutes(1));</div>
<div class="line">    bridge.<a class="code hl_function" href="classhueplusplus_1_1_bridge.html#a7bd607246130312915a3b07116c72301">lights</a>().<a class="code hl_function" href="classhueplusplus_1_1_resource_list.html#aa165e446439defcae7d1bf05b4576739">setRefreshDuration</a>(std::chrono::seconds(30));</div>
<div class="line">    <a class="code hl_class" href="classhueplusplus_1_1_light.html">hueplusplus::Light</a> light = bridge.<a class="code hl_function" href="classhueplusplus_1_1_bridge.html#a7bd607246130312915a3b07116c72301">lights</a>().<a class="code hl_function" href="classhueplusplus_1_1_resource_list.html#a7bcf2ed48e70e9f11a4b6bdc24e0e611">get</a>(1);</div>
<div class="line">    <span class="comment">// ... wait some time</span></div>
<div class="line">    <span class="keywordtype">bool</span> on = light.<a class="code hl_function" href="classhueplusplus_1_1_light.html#a26172501723aeec5abcf8db5b0dc6986">isOn</a>();</div>
<div class="ttc" id="aclasshueplusplus_1_1_bridge_html_a7bd607246130312915a3b07116c72301"><div class="ttname"><a href="classhueplusplus_1_1_bridge.html#a7bd607246130312915a3b07116c72301">hueplusplus::Bridge::lights</a></div><div class="ttdeci">LightList &amp; lights()</div><div class="ttdoc">Provides access to the Lights on the bridge.</div><div class="ttdef"><b>Definition</b> Bridge.cpp:340</div></div>
<div class="ttc" id="aclasshueplusplus_1_1_bridge_html_adc8372a1ca66b86098ae5a841106d89b"><div class="ttname"><a href="classhueplusplus_1_1_bridge.html#adc8372a1ca66b86098ae5a841106d89b">hueplusplus::Bridge::setRefreshDuration</a></div><div class="ttdeci">void setRefreshDuration(std::chrono::steady_clock::duration refreshDuration)</div><div class="ttdoc">Sets refresh interval for the whole bridge state.</div><div class="ttdef"><b>Definition</b> Bridge.cpp:186</div></div>
<div class="ttc" id="aclasshueplusplus_1_1_light_html"><div class="ttname"><a href="classhueplusplus_1_1_light.html">hueplusplus::Light</a></div><div class="ttdoc">Class for Hue Light fixtures.</div><div class="ttdef"><b>Definition</b> Light.h:61</div></div>
<div class="ttc" id="aclasshueplusplus_1_1_light_html_a26172501723aeec5abcf8db5b0dc6986"><div class="ttname"><a href="classhueplusplus_1_1_light.html#a26172501723aeec5abcf8db5b0dc6986">hueplusplus::Light::isOn</a></div><div class="ttdeci">virtual bool isOn()</div><div class="ttdoc">Function to check whether a light is on or off.</div><div class="ttdef"><b>Definition</b> Light.cpp:44</div></div>
<div class="ttc" id="aclasshueplusplus_1_1_resource_list_html_a7bcf2ed48e70e9f11a4b6bdc24e0e611"><div class="ttname"><a href="classhueplusplus_1_1_resource_list.html#a7bcf2ed48e70e9f11a4b6bdc24e0e611">hueplusplus::ResourceList::get</a></div><div class="ttdeci">Resource get(const IdType &amp;id)</div><div class="ttdoc">Get resource specified by id.</div><div class="ttdef"><b>Definition</b> ResourceList.h:126</div></div>
<div class="ttc" id="aclasshueplusplus_1_1_resource_list_html_aa165e446439defcae7d1bf05b4576739"><div class="ttname"><a href="classhueplusplus_1_1_resource_list.html#aa165e446439defcae7d1bf05b4576739">hueplusplus::ResourceList::setRefreshDuration</a></div><div class="ttdeci">void setRefreshDuration(std::chrono::steady_clock::duration refreshDuration)</div><div class="ttdoc">Sets custom refresh interval for this list and all resources created.</div><div class="ttdef"><b>Definition</b> ResourceList.h:96</div></div>
</div><!-- fragment --><p> <a class="el" href="classhueplusplus_1_1_light.html#a26172501723aeec5abcf8db5b0dc6986">isOn()</a> is a non-const method (in this case). That means it will refresh the state if it is outdated. The default refresh time is inherited from <code>bridge.lights()</code>, so it is 30 seconds. After 30 seconds, the state of <code>light</code> <em>and</em> <code>bridge.lights()</code> is outdated. Therefore, the entire list of lights is updated at this point.</p>
<p>After more than one minute, the bridge state is considered outdated. This means that <code>isOn()</code> causes an update of the entire bridge. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
